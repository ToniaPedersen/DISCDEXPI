Notes in NOAKA
==============

Object Model
------------

- Notes are modeled as objects with a Name (string, e.g., "NOTE 1") and a Text (string, e.g., "CAUTION, HOT!").
- Each note is identified via an ID (xml:id, e.g., "Note-1"). The ID has no external meaning, it is only used to refer to a note within a Proteus file.
- Notes are "global", they are owned by the MetaData object.
- Any engineering object (e.g., a CentrifugalPump) can refer to any number of notes. Each note can be referred to by any number of engineering objects.

Graphics
--------

- For each note in the MetaData object, the Diagram can have a NoteLabel. This label essentially gives the position and rotation of the note Name and Text (concatenated to a single string, separated by a space) as shown in the diagram.
- For each note referred to by an engineering object, the engineering object can have a NoteNameLabel. This label essentially gives the position and rotation of the note Name as shown in the diagram.

Implementation in Proteus
-------------------------

- Each note object is implemented as a DEXPI CustomStringAttribute of the MetaData object. The string values are a JSON serialization of the note's attributes.

  <MetaData ID = "metaData1" ComponentClass = "MetaData" ComponentClassURI = "http://sandbox.dexpi.org/rdl/MetaData">
    <GenericAttributes Set = "CustomAttributes" Number = "3">
      <GenericAttribute
        Name = "Note"
        AttributeURI = "http://sandbox.dexpi.org/rdl/Note"
        Format = "string"
        Type = "String"
        TypeURI = "http://sandbox.dexpi.org/rdl/String"
        Value = '{
            id="Note-1", Name="NOTE 1", Text="CAUTION, HOT!"}'/>
      <GenericAttribute
        Name = "Note-1"
        AttributeURI = "http://sandbox.dexpi.org/rdl/Note"
        Format = "string"
        Type = "String"
        TypeURI = "http://sandbox.dexpi.org/rdl/String"
        Value = '{
            id="Note-2", Name="NOTE 2-3", Text="NOTES DELETED"}'/>
      <GenericAttribute
        Name = "Note-2"
        AttributeURI = "http://sandbox.dexpi.org/rdl/Note"
        Format = "string"
        Type = "String"
        TypeURI = "http://sandbox.dexpi.org/rdl/String"
        Value = '{
            id="Note-3", Name="NOTE 4", Text="PAINTED BLUE"}'/>
    </GenericAttributes>
  </MetaData>
  
  
- NoteLabels are implemented as CustomLabels in the <Diagram>. Like for PipingLabels, we omit 
  details that are pre-defined in the profile (font, names of the attributes shown, ...).

  <Drawing>
    <Label ID = "NoteLabel-1" ComponentClass = "CustomLabel" ComponentClassURI = "http://sandbox.dexpi.org/rdl/CustomLabel">
      <!--CustomLabel with type NoteLabel: Note Name and Note Text, e.g., "NOTE 1 CAUTION, HOT!" for Note-1. -->
      <GenericAttributes Set = "DexpiAttributes" Number = "2">
        <GenericAttribute
          Name = "TypeNameAssignmentClass"
          AttributeURI = "http://sandbox.dexpi.org/rdl/TypeNameAssignmentClass"
          Format = "string"
          Value = "NoteLabel"/>
        <GenericAttribute
          Name = "TypeURIAssignmentClass"
          AttributeURI = "http://sandbox.dexpi.org/rdl/TypeURIAssignmentClass"
          Format = "anyURI"
          Value = "http://www.example.org/NoteLabel"/>
      </GenericAttributes>
      <Text Font = "" Height = "0.0" Width = "0">
        <!--Text width required? -->
        <Position>
          <Location X = "0.01" Y = "0.01" Z = "0"/>
          <Axis X = "0" Y = "0" Z = "1"/>
          <Reference X = "1" Y = "0" Z = "0"/>
        </Position>
        <TextStringFormatSpecification>
          <!-- This will require a small change in Proteus Schema (type of ItemID is xsd:idref, but there is no such ID). -->
          <ObjectAttributesReference ItemID = "Note-1"/>
        </TextStringFormatSpecification>
      </Text>
    </Label>
  </Drawing>

- Note references in engineering objects are implemented as DEXPI CustomStringAttributes. The string values are the Note IDs.

  <Equipment
    ID = "CentrifugalPump-1"
    ComponentClass = "CentrifugalPump"
    ComponentClassURI = "http://data.posccaesar.org/rdl/RDS416834"
    ComponentName = "...">
    <GenericAttributes Set = "CustomAttributes" Number = "1">
      <!--Note with ID "Note-1", i.e., "NOTE 1", is attached to this Pump. -->
      <GenericAttribute
        AttributeURI = "http://sandbox.dexpi.org/rdl/Notes"
        Format = "string"
        Name = "Notes"
        Value = "Note-1"/>
    </GenericAttributes>
    ...
  </Equipment>
  
- NoteNameLabels are implemented as CustomLabels of the owning engineering object. Like for PipingLabels, we omit 
  details that are pre-defined in the profile (font, name of the attribute shown, ...). However, we need to add a reference to the Note because an object may refer to more than one note.

  <Equipment ...>
    ...
    <Label ID = "NoteNameLabel-1" ComponentClass = "CustomLabel" ComponentClassURI = "http://sandbox.dexpi.org/rdl/CustomLabel">
      <!--CustomLabel with type NoteNameLabel: Note Name, e.g., "NOTE 1" for Note-1. -->
      <GenericAttributes Set = "DexpiAttributes" Number = "2">
        <GenericAttribute
          Name = "TypeNameAssignmentClass"
          AttributeURI = "http://sandbox.dexpi.org/rdl/TypeNameAssignmentClass"
          Format = "string"
          Value = "NoteNameLabel"/>
        <GenericAttribute
          Name = "TypeURIAssignmentClass"
          AttributeURI = "http://sandbox.dexpi.org/rdl/TypeURIAssignmentClass"
          Format = "anyURI"
          Value = "http://www.example.org/NoteNameLabel"/>
      </GenericAttributes>
      <Text Font = "" Height = "0.0" Width = "0">
        <Position>
          <Location X = "0.02" Y = "0.007765" Z = "0"/>
          <Axis X = "0" Y = "0" Z = "1"/>
          <Reference X = "1" Y = "0" Z = "0"/>
        </Position>
        <TextStringFormatSpecification>
          <!-- This will require a small change in Proteus Schema (type of ItemID is xsd:idref, but there is no such ID). -->
          <ObjectAttributesReference ItemID = "Note-1"/>
        </TextStringFormatSpecification>
      </Text>
    </Label>
  </Equipment>
